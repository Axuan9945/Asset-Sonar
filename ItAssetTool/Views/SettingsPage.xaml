<Page
    x:Class="ItAssetTool.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:ItAssetTool.ViewModels"
    mc:Ignorable="d"
    x:Name="SettingsPageRoot">
    <Page.Resources>
        <DataTemplate x:Key="IdMapTemplate" x:DataType="vm:IdMapEntry">
            <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,2">
                <TextBox Grid.Column="0" Text="{x:Bind Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="类别名称" Margin="0,0,10,0"/>
                <NumberBox Grid.Column="1" Value="{x:Bind Id, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="100" SpinButtonPlacementMode="Compact" Margin="0,0,10,0"/>
                <Button Grid.Column="2" Content="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                        Command="{Binding DataContext.RemoveMapEntryCommand, ElementName=SettingsPageRoot}"
                        CommandParameter="{x:Bind}"
                        Padding="8,4" MinWidth="0"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="CodeMapTemplate" x:DataType="vm:CodeMapEntry">
            <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,2">
                <TextBox Grid.Column="0" Text="{x:Bind Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="类别名称" Margin="0,0,10,0"/>
                <TextBox Grid.Column="1" Text="{x:Bind Code, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="100" PlaceholderText="代码" Margin="0,0,10,0"/>
                <Button Grid.Column="2" Content="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                        Command="{Binding DataContext.RemoveMapEntryCommand, ElementName=SettingsPageRoot}"
                        CommandParameter="{x:Bind}"
                        Padding="8,4" MinWidth="0"/>
            </Grid>
        </DataTemplate>
    </Page.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel x:Name="SettingsPanel" Margin="20" Spacing="10">
            <TextBlock Text="配置管理" Style="{ThemeResource TitleTextBlockStyle}"/>

            <Grid ColumnDefinitions="*, Auto, Auto, Auto" Margin="0,0,0,20">
                <ComboBox Grid.Column="0" Header="配置方案"
                          ItemsSource="{Binding ProfileNames}"
                          SelectedItem="{Binding SelectedProfileName, Mode=TwoWay}"/>
                <Button Grid.Column="1" Content="新建" x:Name="NewProfileButton" Click="NewProfileButton_Click" Margin="10,0,0,0"/>
                <Button Grid.Column="2" Content="保存" Command="{Binding SaveCommand}" Margin="10,0,0,0"/>
                <Button Grid.Column="3" Content="删除" Command="{Binding DeleteProfileCommand}" Margin="10,0,0,0"/>
            </Grid>

            <TextBlock Text="Snipe-IT API 连接" Style="{ThemeResource SubtitleTextBlockStyle}" Margin="0,10,0,0"/>
            <TextBox Header="内网 URL" Text="{Binding SelectedProfile.InternalUrl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <TextBox Header="外网 URL" Text="{Binding SelectedProfile.ExternalUrl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <PasswordBox Header="API Key" Password="{Binding SelectedProfile.ApiKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <TextBox Header="资产标签前缀 (ASSET_TAG_PREFIX)" Text="{Binding SelectedProfile.ASSET_TAG_PREFIX, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>


            <TextBlock Text="用户分配信息" Style="{ThemeResource SubtitleTextBlockStyle}" Margin="0,20,0,0"/>
            <TextBox Header="所属部门" Text="{Binding SelectedProfile.Department, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <TextBox Header="用户姓名" Text="{Binding SelectedProfile.AssignName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <TextBox Header="用户名/工号" Text="{Binding SelectedProfile.AssignUser, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <PasswordBox Header="新用户密码" Password="{Binding SelectedProfile.AssignPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <TextBox Header="邮箱后缀" Text="{Binding SelectedProfile.EmailSuffix, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>


            <TextBlock Text="Snipe-IT ID 映射" Style="{ThemeResource SubtitleTextBlockStyle}" Margin="0,20,0,0"/>
            <Grid ColumnDefinitions="*,*" ColumnSpacing="20" RowDefinitions="Auto, Auto">

                <StackPanel Grid.Row="0" Grid.Column="0" Spacing="5" Margin="0,10,0,10">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="资产类别 (Category ID Map)" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <Button Grid.Column="1" Content="添加"
                                Command="{Binding AddMapEntryCommand}" CommandParameter="Category"/>
                    </Grid>
                    <ListView ItemsSource="{Binding CategoryIdMaps}" ItemTemplate="{StaticResource IdMapTemplate}" MaxHeight="200"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="1" Spacing="5" Margin="0,10,0,10">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="组件类别 (Component ID Map)" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <Button Grid.Column="1" Content="添加"
                                Command="{Binding AddMapEntryCommand}" CommandParameter="Component"/>
                    </Grid>
                    <ListView ItemsSource="{Binding ComponentIdMaps}" ItemTemplate="{StaticResource IdMapTemplate}" MaxHeight="200"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="0" Spacing="5" Margin="0,10,0,10">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="配件类别 (Accessory ID Map)" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <Button Grid.Column="1" Content="添加"
                                Command="{Binding AddMapEntryCommand}" CommandParameter="Accessory"/>
                    </Grid>
                    <ListView ItemsSource="{Binding AccessoryIdMaps}" ItemTemplate="{StaticResource IdMapTemplate}" MaxHeight="200"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="1" Spacing="5" Margin="0,10,0,10">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="资产代码 (Category Code Map)" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <Button Grid.Column="1" Content="添加"
                                Command="{Binding AddMapEntryCommand}" CommandParameter="Code"/>
                    </Grid>
                    <ListView ItemsSource="{Binding CategoryCodeMaps}" ItemTemplate="{StaticResource CodeMapTemplate}" MaxHeight="200"/>
                </StackPanel>
            </Grid>
        </StackPanel>
    </ScrollViewer>
</Page>